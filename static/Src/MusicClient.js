const Socket=io();let SongNameLabel,PlayButton,MusicProgressBar,Duration,FavouriteImg,LoopImg,MusicDurationLabel,CurrentUrl="";document.addEventListener("DOMContentLoaded",(function(){SongNameLabel=document.getElementById("SongName"),PlayButton=document.getElementById("PlayButton"),MusicProgressBar=document.getElementById("MusicProgressBar"),FavouriteImg=document.getElementById("FavImg"),LoopImg=document.getElementById("LoopImg"),MusicProgressBar.value=0,MusicDurationLabel=document.getElementById("MusicDurationLabel"),MusicProgressBar.addEventListener("change",(()=>{SetDuration(parseInt(MusicProgressBar.value)/1e3*Duration),UserDragging=!1})),MusicProgressBar.addEventListener("mousedown",(()=>{UserDragging=!0})),MusicProgressBar.addEventListener("touchstart",(()=>{UserDragging=!0}))}));const PlayButtonTexts={true:"Pause",false:"Play"};let UserDragging=!1;function FormatTime(e){if(e<0)return"00:00";const t=Math.floor(Math.abs(e)),n=Math.floor(t/3600),o=Math.floor(t%3600/60),a=t%60,i=e=>String(e).padStart(2,"0");return n>0?`${n}:${i(o)}:${i(a)}`:`${i(o)}:${i(a)}`}function SetDuration(e){Socket.emit("ClientSubmit",{RequestType:"SetDuration",Data:e})}function ClearResultsList(){document.getElementById("SearchResultsContainer").innerHTML=""}function PlaySong(e){CurrentUrl=e,Socket.emit("ClientSubmit",{RequestType:"PlaySong",Data:e})}function FavouriteSong(){Socket.emit("ClientSubmit",{RequestType:"SetFavourite",Data:CurrentUrl})}function LoopSong(){Socket.emit("ClientSubmit",{RequestType:"ToggleLoop",Data:"I want to keep listening to that masterpiece"})}function AddResultsList(e,t){const n=document.getElementById("SearchResultsContainer"),o=document.createElement("li"),a=document.createElement("Button");o.style="list-style-type: none;",a.textContent=e,a.className="SearchResultsList",a.id=t,a.onclick=function(){PlaySong(this.id)},o.appendChild(a),n.appendChild(o)}function DisablePlayingFeatures(e){}function ToggleSongPlaying(){Socket.emit("ClientSubmit",{RequestType:"PauseSong",Data:"PAUSE THAT SH*T"})}function OnSubmit(){var e=document.getElementById("MusicSearch");ClearResultsList();var t={RequestType:"SearchSongs",Data:e.value};Socket.emit("ClientSubmit",t)}function ShowFavourites(){Socket.emit("ClientSubmit",{RequestType:"ShowFavourites",Data:"PLZ PLZ PLZ"})}Socket.on("connect",(function(){console.log("Connected succesfully")})),Socket.on("GenericResponse",(function(e){console.log("Server Message: "+e.Status)})),Socket.on("SearchResults",(function(e){Result=e.Result,Details=e.Details,!0===Details.RemovePreviousResults&&ClearResultsList(),AddResultsList(Result.Name+" by "+Result.Author,Result.Url)})),Socket.on("ServerDetails",(function(e){MusicDetails=e.Music;var t=MusicDetails.Name;""==t?SongNameLabel.textContent="Nothing is playing":0==MusicDetails.SongLoaded?SongNameLabel.textContent=`Loading ${t}`:SongNameLabel.textContent=`Playing ${t}`,PlayButton.textContent=PlayButtonTexts[MusicDetails.IsPlaying];let n=MusicDetails.TimePosition;if(Duration=MusicDetails.TimeLength,CurrentUrl=MusicDetails.CurrentUrl,MusicDurationLabel.textContent=FormatTime(n)+"/"+FormatTime(Duration),0==UserDragging){let e=n/Duration*1e3;MusicProgressBar.value=e}1==MusicDetails.IsFavourited?FavouriteImg.src="static/Icons/Favourite/True.png":FavouriteImg.src="static/Icons/Favourite/False.png",1==MusicDetails.IsLooping?LoopImg.src="static/Icons/Loop/True.png":LoopImg.src="static/Icons/Loop/False.png"})),document.addEventListener("keydown",(function(e){"Enter"===e.key?(e.preventDefault(),OnSubmit()):" "===e.key&&(e.preventDefault(),ToggleSongPlaying())}));